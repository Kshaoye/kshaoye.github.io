import{_ as a,c as r,o,ag as l}from"./chunks/framework.z0p7P-Mv.js";const c=JSON.parse('{"title":"探针","description":"","frontmatter":{},"headers":[],"relativePath":"zh/k8s/probe.md","filePath":"zh/k8s/probe.md"}'),t={name:"zh/k8s/probe.md"};function i(s,e,n,d,u,h){return o(),r("div",null,[...e[0]||(e[0]=[l('<h1 id="探针" tabindex="-1">探针 <a class="header-anchor" href="#探针" aria-label="Permalink to &quot;探针&quot;">​</a></h1><h2 id="探针简介" tabindex="-1">探针简介 <a class="header-anchor" href="#探针简介" aria-label="Permalink to &quot;探针简介&quot;">​</a></h2><ul><li>探针是由 kubelet 对容器执行的定期诊断，以保证Pod的状态始终处于运行状态。</li><li>每次探测都将获得以下三种结果之一： 1、成功：容器通过了诊断 2、失败：容器未通过诊断 3、未知：诊断结果未知，不采取任何行动。</li></ul><h2 id="pod重启策略" tabindex="-1">Pod重启策略 <a class="header-anchor" href="#pod重启策略" aria-label="Permalink to &quot;Pod重启策略&quot;">​</a></h2><p>Pod一旦配置探针，在检测失败时候，会基于restartPolicy对Pod进行下一步操作：</p><ul><li>Always：当容器异常时，k8s自动重启该容器， ReplicationController/Replicaset/Deployment，默认为Always。</li><li>OnFailure：当容器失败时(容器停止运行且退出码不为0)，k8s自动重启该容器。</li><li>Nerver：不论容器运行状态如何都不会重启该容器</li></ul><h2 id="镜像拉取策略" tabindex="-1">镜像拉取策略 <a class="header-anchor" href="#镜像拉取策略" aria-label="Permalink to &quot;镜像拉取策略&quot;">​</a></h2><ul><li>IfNotPresent：node节点没有此镜像就去指定的镜像仓库拉取，node有就使用node本地镜像。</li><li>Always：每次重建pod都会重新拉取镜像</li><li>Never：从不到镜像中心拉取镜像，只使用本地镜像</li></ul><h2 id="探针类型" tabindex="-1">探针类型 <a class="header-anchor" href="#探针类型" aria-label="Permalink to &quot;探针类型&quot;">​</a></h2><ul><li>startupProbe: 启动探针,用于<strong>判断容器内的应用程序是否已启动完成</strong>，如果配置了启动探测，则会先禁用所有其它的探测，直到startupProbe检测成功为止，如果startupProbe探测失败，则kubelet将杀死容器，容器将按照重启策略进行下一步操作，如果容器没有提供启动探测，则默认状态为成功。</li><li>livenessProbe: #存活探针,用于<strong>检测容器容器是否正在运行</strong>，如果存活探测失败，则kubelet会杀死容器，并且容器将受到其重启策略的影响，如果容器不提供存活探针，则默认 状态为 Success，livenessProbe用于控制是否重启pod。</li><li>readinessProbe: #就绪探针，如果就绪探测失败，端点控制器将从与Pod匹配的所有Service的端点中删除该Pod的IP地址，初始延迟之前的就绪状态默认为Failure(失败)，如果容器不提供就绪探针，则默认状态为 Success，readinessProbe用于<strong>控制pod是否添加至service</strong>。</li></ul><p>拓展内容： <a href="./InterviewQuestions/what_happens_when_a_probe_fails_in_kubernetes.html">探针失败后，Kubernetes 到底会发生什么?</a></p>',11)])])}const _=a(t,[["render",i]]);export{c as __pageData,_ as default};
