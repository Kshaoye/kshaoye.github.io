import{_ as a,c as i,o as e,ag as l}from"./chunks/framework.z0p7P-Mv.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"zh/k8s/InterviewQuestions/what_happens_when_a_probe_fails_in_kubernetes.md","filePath":"zh/k8s/InterviewQuestions/what_happens_when_a_probe_fails_in_kubernetes.md"}'),n={name:"zh/k8s/InterviewQuestions/what_happens_when_a_probe_fails_in_kubernetes.md"};function t(r,s,o,p,h,d){return e(),i("div",null,[...s[0]||(s[0]=[l(`<hr><h2 id="ä¸€å¥è¯æ€»è§ˆ-éœ€è¦è®°ä½" tabindex="-1">ä¸€å¥è¯æ€»è§ˆï¼ˆéœ€è¦è®°ä½ï¼‰ <a class="header-anchor" href="#ä¸€å¥è¯æ€»è§ˆ-éœ€è¦è®°ä½" aria-label="Permalink to &quot;ä¸€å¥è¯æ€»è§ˆï¼ˆéœ€è¦è®°ä½ï¼‰&quot;">â€‹</a></h2><blockquote><p><strong>æ¢é’ˆå¤±è´¥åï¼Œç”± kubelet æ ¹æ®æ¢é’ˆç±»å‹é‡‡å–ä¸åŒåŠ¨ä½œï¼š readinesså½±å“æµé‡ï¼Œlivenessè§¦å‘é‡å¯ï¼Œstartupå†³å®šæ˜¯å¦å¯ç”¨å‰ä¸¤è€…ã€‚</strong></p></blockquote><hr><h2 id="ä¸‰ä¸ªæ¢é’ˆ-å„è‡ª-å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1">ä¸‰ä¸ªæ¢é’ˆï¼Œå„è‡ªâ€œå¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆâ€ <a class="header-anchor" href="#ä¸‰ä¸ªæ¢é’ˆ-å„è‡ª-å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆ" aria-label="Permalink to &quot;ä¸‰ä¸ªæ¢é’ˆï¼Œå„è‡ªâ€œå¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆâ€&quot;">â€‹</a></h2><h3 id="_1ï¸âƒ£-readiness-probe-å°±ç»ªæ¢é’ˆ-â€”â€”ä¸æ€è¿›ç¨‹-åªåœæµé‡" tabindex="-1">1ï¸âƒ£ Readiness Probeï¼ˆå°±ç»ªæ¢é’ˆï¼‰â€”â€”<strong>ä¸æ€è¿›ç¨‹ï¼Œåªåœæµé‡</strong> <a class="header-anchor" href="#_1ï¸âƒ£-readiness-probe-å°±ç»ªæ¢é’ˆ-â€”â€”ä¸æ€è¿›ç¨‹-åªåœæµé‡" aria-label="Permalink to &quot;1ï¸âƒ£ Readiness Probeï¼ˆå°±ç»ªæ¢é’ˆï¼‰â€”â€”**ä¸æ€è¿›ç¨‹ï¼Œåªåœæµé‡**&quot;">â€‹</a></h3><p><strong>å¤±è´¥åå‘ç”Ÿçš„äº‹ï¼š</strong></p><ul><li>kubelet å°† Pod æ ‡è®°ä¸º <strong>NotReady</strong></li><li>å¯¹åº” Endpoint <strong>ä» Service ä¸­ç§»é™¤</strong></li><li><strong>æµé‡ä¸å†è½¬å‘åˆ°è¯¥ Pod</strong></li><li>å®¹å™¨ <strong>ä¸ä¼šè¢«é‡å¯</strong></li></ul><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>å¯åŠ¨æ…¢</li><li>ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼ˆDB / MQï¼‰</li><li>ä¸´æ—¶è¿‡è½½</li></ul><p>ğŸ‘‰ <strong>è¿™æ˜¯â€œä¿æŠ¤ç”¨æˆ·â€çš„æ¢é’ˆ</strong></p><hr><h3 id="_2ï¸âƒ£-liveness-probe-å­˜æ´»æ¢é’ˆ-â€”â€”å¤±è´¥å°±é‡å¯å®¹å™¨" tabindex="-1">2ï¸âƒ£ Liveness Probeï¼ˆå­˜æ´»æ¢é’ˆï¼‰â€”â€”<strong>å¤±è´¥å°±é‡å¯å®¹å™¨</strong> <a class="header-anchor" href="#_2ï¸âƒ£-liveness-probe-å­˜æ´»æ¢é’ˆ-â€”â€”å¤±è´¥å°±é‡å¯å®¹å™¨" aria-label="Permalink to &quot;2ï¸âƒ£ Liveness Probeï¼ˆå­˜æ´»æ¢é’ˆï¼‰â€”â€”**å¤±è´¥å°±é‡å¯å®¹å™¨**&quot;">â€‹</a></h3><p><strong>å¤±è´¥åå‘ç”Ÿçš„äº‹ï¼š</strong></p><ul><li>kubelet åˆ¤å®šå®¹å™¨â€œå¡æ­»/å¼‚å¸¸â€</li><li><strong>ç›´æ¥æ€æ‰å®¹å™¨</strong></li><li>æŒ‰é‡å¯ç­–ç•¥ <strong>é‡æ–°æ‹‰èµ·å®¹å™¨</strong></li><li>Pod IP é€šå¸¸ä¸å˜ï¼ˆå®¹å™¨çº§é‡å¯ï¼‰</li></ul><p><strong>é£é™©ç‚¹ï¼ˆéå¸¸é‡è¦ï¼‰ï¼š</strong></p><ul><li><p>å¦‚æœé…ç½®ä¸å½“ï¼š</p><ul><li>å¯åŠ¨æ…¢ = è¢«åå¤æ€</li><li>å½¢æˆ <strong>CrashLoopBackOff</strong></li></ul></li></ul><p>ğŸ‘‰ <strong>è¿™æ˜¯â€œè‡ªæ„ˆæœºåˆ¶â€ï¼Œä½†é…ç½®é”™äº†å°±æ˜¯è‡ªæ€æœºåˆ¶</strong></p><hr><h3 id="_3ï¸âƒ£-startup-probe-å¯åŠ¨æ¢é’ˆ-â€”â€”ç»™-æ…¢å¯åŠ¨-å…œåº•" tabindex="-1">3ï¸âƒ£ Startup Probeï¼ˆå¯åŠ¨æ¢é’ˆï¼‰â€”â€”<strong>ç»™â€œæ…¢å¯åŠ¨â€å…œåº•</strong> <a class="header-anchor" href="#_3ï¸âƒ£-startup-probe-å¯åŠ¨æ¢é’ˆ-â€”â€”ç»™-æ…¢å¯åŠ¨-å…œåº•" aria-label="Permalink to &quot;3ï¸âƒ£ Startup Probeï¼ˆå¯åŠ¨æ¢é’ˆï¼‰â€”â€”**ç»™â€œæ…¢å¯åŠ¨â€å…œåº•**&quot;">â€‹</a></h3><p><strong>å¤±è´¥åå‘ç”Ÿçš„äº‹ï¼š</strong></p><ul><li><p>åœ¨ startup probe <strong>æˆåŠŸä¹‹å‰</strong>ï¼š</p><ul><li>liveness / readiness <strong>éƒ½ä¸ä¼šç”Ÿæ•ˆ</strong></li></ul></li><li><p>å¦‚æœ startup probe <strong>æœ€ç»ˆå¤±è´¥</strong>ï¼š</p><ul><li>kubelet ä¼šæ€å®¹å™¨å¹¶é‡å¯</li></ul></li></ul><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>Java åº”ç”¨</li><li>åˆå§‹åŒ–æ—¶é—´é•¿</li><li>å†·å¯åŠ¨æ…¢çš„æœåŠ¡</li></ul><p>ğŸ‘‰ <strong>è¿™æ˜¯é˜²æ­¢â€œå¯åŠ¨é˜¶æ®µè¢« liveness è¯¯æ€â€</strong></p><hr><h2 id="å®Œæ•´æ—¶é—´çº¿-å¿…çŸ¥å¿…ä¼š" tabindex="-1">å®Œæ•´æ—¶é—´çº¿ï¼ˆå¿…çŸ¥å¿…ä¼šï¼‰ <a class="header-anchor" href="#å®Œæ•´æ—¶é—´çº¿-å¿…çŸ¥å¿…ä¼š" aria-label="Permalink to &quot;å®Œæ•´æ—¶é—´çº¿ï¼ˆå¿…çŸ¥å¿…ä¼šï¼‰&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Pod å¯åŠ¨</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>Startup Probeï¼ˆé€šè¿‡ï¼Ÿï¼‰</span></span>
<span class="line"><span>  â†“ æ˜¯</span></span>
<span class="line"><span>Readiness Probeï¼ˆæ˜¯å¦æ¥æµé‡ï¼‰</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>Liveness Probeï¼ˆæ˜¯å¦è¯¥é‡å¯ï¼‰</span></span></code></pre></div><p><strong>é¡ºåºè®°å¿†å£è¯€ï¼š</strong></p><blockquote><p><strong>å…ˆå¯åŠ¨ â†’ å†æ¥æµé‡ â†’ æœ€åè°ˆç”Ÿæ­»</strong></p></blockquote><hr><h2 id="kubelet-åœ¨è¿™é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²-é¢è¯•å®˜å¾ˆçˆ±é—®" tabindex="-1">kubelet åœ¨è¿™é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿï¼ˆé¢è¯•å®˜å¾ˆçˆ±é—®ï¼‰ <a class="header-anchor" href="#kubelet-åœ¨è¿™é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²-é¢è¯•å®˜å¾ˆçˆ±é—®" aria-label="Permalink to &quot;kubelet åœ¨è¿™é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿï¼ˆé¢è¯•å®˜å¾ˆçˆ±é—®ï¼‰&quot;">â€‹</a></h2><ul><li><p>æ¢é’ˆ <strong>ä¸æ˜¯ controller åšçš„</strong></p></li><li><p><strong>å…¨éƒ¨ç”± kubelet åœ¨ Node æœ¬åœ°æ‰§è¡Œ</strong></p></li><li><p>kubeletï¼š</p><ul><li>å®šæœŸæ‰§è¡Œæ¢é’ˆ</li><li>æ ¹æ®ç»“æœæ›´æ–° Pod çŠ¶æ€</li><li>å†³å®šæ˜¯å¦æ€å®¹å™¨</li></ul></li></ul><p>ğŸ‘‰ <strong>è¿™æ˜¯ Node çº§è¡Œä¸ºï¼Œä¸æ˜¯é›†ç¾¤çº§è°ƒåº¦</strong></p><hr><h2 id="å¸¸è§-è¸©å‘åœºæ™¯-ç”Ÿäº§å¿…æ‡‚" tabindex="-1">å¸¸è§â€œè¸©å‘åœºæ™¯â€ï¼ˆç”Ÿäº§å¿…æ‡‚ï¼‰ <a class="header-anchor" href="#å¸¸è§-è¸©å‘åœºæ™¯-ç”Ÿäº§å¿…æ‡‚" aria-label="Permalink to &quot;å¸¸è§â€œè¸©å‘åœºæ™¯â€ï¼ˆç”Ÿäº§å¿…æ‡‚ï¼‰&quot;">â€‹</a></h2><h3 id="âŒ-åªé…-liveness-ä¸é…-readiness" tabindex="-1">âŒ åªé… livenessï¼Œä¸é… readiness <a class="header-anchor" href="#âŒ-åªé…-liveness-ä¸é…-readiness" aria-label="Permalink to &quot;âŒ åªé… livenessï¼Œä¸é… readiness&quot;">â€‹</a></h3><ul><li>æœåŠ¡æ…¢äº† â†’ è¢«é‡å¯</li><li>å®é™…åªéœ€è¦â€œæš‚æ—¶ä¸‹çº¿â€</li></ul><h3 id="âŒ-liveness-æ£€æŸ¥ä¸šåŠ¡æ¥å£" tabindex="-1">âŒ liveness æ£€æŸ¥ä¸šåŠ¡æ¥å£ <a class="header-anchor" href="#âŒ-liveness-æ£€æŸ¥ä¸šåŠ¡æ¥å£" aria-label="Permalink to &quot;âŒ liveness æ£€æŸ¥ä¸šåŠ¡æ¥å£&quot;">â€‹</a></h3><ul><li>ä¾èµ– DB / Redis</li><li>å¤–éƒ¨æŠ–åŠ¨ â†’ Pod è¢«è¯¯æ€</li></ul><h3 id="âŒ-æ²¡æœ‰-startup-probe" tabindex="-1">âŒ æ²¡æœ‰ startup probe <a class="header-anchor" href="#âŒ-æ²¡æœ‰-startup-probe" aria-label="Permalink to &quot;âŒ æ²¡æœ‰ startup probe&quot;">â€‹</a></h3><ul><li>å¯åŠ¨æ…¢</li><li>è¿˜æ²¡ ready å°±è¢«æ€</li></ul><hr><h2 id="å‡†ç”Ÿäº§çº§é…ç½®åŸåˆ™" tabindex="-1">å‡†ç”Ÿäº§çº§é…ç½®åŸåˆ™ <a class="header-anchor" href="#å‡†ç”Ÿäº§çº§é…ç½®åŸåˆ™" aria-label="Permalink to &quot;å‡†ç”Ÿäº§çº§é…ç½®åŸåˆ™&quot;">â€‹</a></h2><blockquote><p><strong>Readiness ç”¨æ¥æŒ¡æµé‡ Liveness ç”¨æ¥æ•‘å¡æ­» Startup ç”¨æ¥ä¿å¯åŠ¨</strong></p></blockquote><hr><h2 id="é¢è¯•å›ç­”å‚è€ƒ-å¯ä»¥ç›´æ¥ç”¨" tabindex="-1">é¢è¯•å›ç­”å‚è€ƒï¼ˆå¯ä»¥ç›´æ¥ç”¨ï¼‰ <a class="header-anchor" href="#é¢è¯•å›ç­”å‚è€ƒ-å¯ä»¥ç›´æ¥ç”¨" aria-label="Permalink to &quot;é¢è¯•å›ç­”å‚è€ƒï¼ˆå¯ä»¥ç›´æ¥ç”¨ï¼‰&quot;">â€‹</a></h2><blockquote><p>â€œæ¢é’ˆç”± kubelet æ‰§è¡Œã€‚ readiness å¤±è´¥ä¼šå°† Pod ä» Service Endpoint ä¸­ç§»é™¤ï¼Œä¸ä¼šé‡å¯å®¹å™¨ï¼› liveness å¤±è´¥ä¼šè§¦å‘ kubelet é‡å¯å®¹å™¨ï¼› startup probe ç”¨äºæ…¢å¯åŠ¨åœºæ™¯ï¼Œåœ¨å…¶æˆåŠŸå‰ä¼šå±è”½å‰ä¸¤è€…ï¼Œé˜²æ­¢è¯¯åˆ¤ã€‚â€</p></blockquote><p>è¯´å®Œè¿™æ®µï¼Œè‡³å°‘90% é¢è¯•å®˜ä¼šè¡¨ç¤ºæ»¡æ„ã€‚</p><hr><h2 id="æ‹“å±•-ä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒä¸èƒ½éšä¾¿é…ç½®-liveness-probe" tabindex="-1">æ‹“å±•ï¼šä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒä¸èƒ½éšä¾¿é…ç½® liveness probeï¼Ÿ <a class="header-anchor" href="#æ‹“å±•-ä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒä¸èƒ½éšä¾¿é…ç½®-liveness-probe" aria-label="Permalink to &quot;æ‹“å±•ï¼šä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒä¸èƒ½éšä¾¿é…ç½® liveness probeï¼Ÿ&quot;">â€‹</a></h2><h3 id="ä¸€å¥è¯æ¦‚æ‹¬" tabindex="-1">ä¸€å¥è¯æ¦‚æ‹¬ <a class="header-anchor" href="#ä¸€å¥è¯æ¦‚æ‹¬" aria-label="Permalink to &quot;ä¸€å¥è¯æ¦‚æ‹¬&quot;">â€‹</a></h3><blockquote><p><strong>ç”Ÿäº§ç¯å¢ƒä¸èƒ½éšæ„é…ç½® liveness probe</strong>ï¼Œå› ä¸ºå®ƒ<strong>å…·æœ‰â€œæ€è¿›ç¨‹â€çš„å¼ºå‰¯ä½œç”¨</strong>ï¼› <strong>å¿…é¡»ç»“åˆ startup probe ä½¿ç”¨</strong>ï¼Œå¦åˆ™åœ¨åº”ç”¨å¯åŠ¨æ…¢ã€åˆå§‹åŒ–é‡ã€ä¾èµ–å¤–éƒ¨èµ„æºæ—¶ï¼Œææ˜“è§¦å‘ <strong>CrashLoopBackOff</strong>ï¼Œé€ æˆâ€œè‡ªæ€å¼é‡å¯â€ã€‚</p></blockquote><hr><h3 id="ä¸‰ç§æ¢é’ˆçš„è¡Œä¸ºå·®å¼‚-ç†è§£æ¢é’ˆçš„æ ¸å¿ƒ" tabindex="-1">ä¸‰ç§æ¢é’ˆçš„<strong>è¡Œä¸ºå·®å¼‚</strong>ï¼ˆç†è§£æ¢é’ˆçš„æ ¸å¿ƒï¼‰ï¼š <a class="header-anchor" href="#ä¸‰ç§æ¢é’ˆçš„è¡Œä¸ºå·®å¼‚-ç†è§£æ¢é’ˆçš„æ ¸å¿ƒ" aria-label="Permalink to &quot;ä¸‰ç§æ¢é’ˆçš„**è¡Œä¸ºå·®å¼‚**ï¼ˆç†è§£æ¢é’ˆçš„æ ¸å¿ƒï¼‰ï¼š&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æ¢é’ˆç±»å‹</th><th>å¤±è´¥åä¼šå‘ç”Ÿä»€ä¹ˆ</th><th>å½±å“çº§åˆ«</th></tr></thead><tbody><tr><td><strong>livenessProbe</strong></td><td>kubelet <strong>ç›´æ¥æ€æ‰å®¹å™¨</strong>ï¼Œå¹¶é‡å¯</td><td>âŒ æœ€æ¿€è¿›</td></tr><tr><td><strong>readinessProbe</strong></td><td>Pod è¢«æ ‡è®°ä¸º NotReadyï¼Œä» Service Endpoints ç§»é™¤</td><td>âš ï¸ ä¸æ€è¿›ç¨‹</td></tr><tr><td><strong>startupProbe</strong></td><td>åœ¨æˆåŠŸå‰ <strong>æš‚åœ liveness / readiness</strong></td><td>ğŸ›¡ï¸ ä¿æŠ¤å¯åŠ¨æœŸ</td></tr></tbody></table><p>ğŸ‘‰ <strong>åªæœ‰ liveness probe ä¼šæ€å®¹å™¨</strong></p><hr><h3 id="å¯åŠ¨æ…¢è¢«è¯¯æ€-æ˜¯æ€ä¹ˆå‘ç”Ÿçš„" tabindex="-1">â€œå¯åŠ¨æ…¢è¢«è¯¯æ€â€æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ <a class="header-anchor" href="#å¯åŠ¨æ…¢è¢«è¯¯æ€-æ˜¯æ€ä¹ˆå‘ç”Ÿçš„" aria-label="Permalink to &quot;â€œå¯åŠ¨æ…¢è¢«è¯¯æ€â€æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ&quot;">â€‹</a></h3><p>å…¸å‹ç”Ÿäº§ç¯å¢ƒäº‹æ•…é“¾è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>åº”ç”¨å¯åŠ¨ï¼š</p><ul><li>JVM / Python / Node.js</li><li>åˆå§‹åŒ–é…ç½®</li><li>è¿æ•°æ®åº“ / MQ / ES / Redis</li></ul></li><li><p><strong>ç«¯å£å·²ç›‘å¬ï¼Œä½†æœåŠ¡è¿˜ä¸å¯ç”¨</strong></p></li><li><p>liveness probe å¼€å§‹æ¢æµ‹</p></li><li><p>æ¢æµ‹å¤±è´¥ï¼ˆè¶…æ—¶ / 500ï¼‰</p></li><li><p>kubelet åˆ¤å®šï¼š</p><blockquote><p>â€œè¿™ä¸ªå®¹å™¨ä¸å¥åº·â€</p></blockquote></li><li><p><strong>kill å®¹å™¨</strong></p></li><li><p>é‡å¯ â†’ å†å¤±è´¥ â†’ å† kill</p></li><li><p>è¿›å…¥ <strong>CrashLoopBackOff</strong></p></li></ol><p>âš ï¸ <strong>è¿™ä¸æ˜¯ bugï¼Œæ˜¯ kubelet åœ¨â€œæŒ‰é¢„å…ˆé…ç½®çš„è§„åˆ™æ­£ç¡®æ‰§è¡Œâ€</strong></p><hr><h3 id="ä¸ºä»€ä¹ˆè¯´-ç”Ÿäº§ç¯å¢ƒ-ä¸èƒ½éšä¾¿-ç”¨-liveness-probe" tabindex="-1">ä¸ºä»€ä¹ˆè¯´ï¼šç”Ÿäº§ç¯å¢ƒâ€œä¸èƒ½éšä¾¿â€ç”¨ liveness probe <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¯´-ç”Ÿäº§ç¯å¢ƒ-ä¸èƒ½éšä¾¿-ç”¨-liveness-probe" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¯´ï¼šç”Ÿäº§ç¯å¢ƒâ€œä¸èƒ½éšä¾¿â€ç”¨ liveness probe&quot;">â€‹</a></h3><h4 id="_1ï¸âƒ£-liveness-çš„è®¾è®¡åˆè¡·ä¸æ˜¯-åˆ¤æ–­æœåŠ¡æ˜¯å¦å¯ç”¨" tabindex="-1">1ï¸âƒ£ liveness çš„è®¾è®¡åˆè¡·ä¸æ˜¯â€œåˆ¤æ–­æœåŠ¡æ˜¯å¦å¯ç”¨â€ <a class="header-anchor" href="#_1ï¸âƒ£-liveness-çš„è®¾è®¡åˆè¡·ä¸æ˜¯-åˆ¤æ–­æœåŠ¡æ˜¯å¦å¯ç”¨" aria-label="Permalink to &quot;1ï¸âƒ£ liveness çš„è®¾è®¡åˆè¡·ä¸æ˜¯â€œåˆ¤æ–­æœåŠ¡æ˜¯å¦å¯ç”¨â€&quot;">â€‹</a></h4><p>å®ƒè§£å†³çš„æ˜¯è¿™ä¸€ç±»é—®é¢˜ï¼š</p><ul><li>æ­»é”ï¼ˆdeadlockï¼‰</li><li>çº¿ç¨‹å¡æ­»</li><li>è¿›ç¨‹è¿˜åœ¨ï¼Œä½†<strong>æ°¸è¿œä¸å†å¯¹å¤–å“åº”</strong></li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><blockquote><p><strong>liveness æ˜¯â€œæ•‘ç«ç”¨çš„æœ€åæ‰‹æ®µâ€ï¼Œä¸æ˜¯æ—¥å¸¸å¥åº·æ£€æŸ¥</strong></p></blockquote><hr><h4 id="_2ï¸âƒ£-çœŸå®ç”Ÿäº§ç¯å¢ƒé‡Œ-æ…¢-æ­»" tabindex="-1">2ï¸âƒ£ çœŸå®ç”Ÿäº§ç¯å¢ƒé‡Œï¼Œâ€œæ…¢ â‰  æ­»â€ <a class="header-anchor" href="#_2ï¸âƒ£-çœŸå®ç”Ÿäº§ç¯å¢ƒé‡Œ-æ…¢-æ­»" aria-label="Permalink to &quot;2ï¸âƒ£ çœŸå®ç”Ÿäº§ç¯å¢ƒé‡Œï¼Œâ€œæ…¢ â‰  æ­»â€&quot;">â€‹</a></h4><p>ç°å®æƒ…å†µåŒ…æ‹¬ï¼š</p><ul><li>æ•°æ®åº“å†·å¯åŠ¨</li><li>å¤–éƒ¨ä¾èµ–æ³¢åŠ¨</li><li>å¤§å¯¹è±¡ç¼“å­˜åŠ è½½</li><li>leader election</li><li>schema migration</li></ul><p>è¿™äº›æƒ…å†µï¼š</p><ul><li><strong>readiness åº”è¯¥å¤±è´¥</strong></li><li><strong>liveness ä¸åº”è¯¥å¤±è´¥</strong></li></ul><hr><h3 id="startup-probe-çš„-ç”Ÿäº§çº§æ„ä¹‰" tabindex="-1">startup probe çš„â€œç”Ÿäº§çº§æ„ä¹‰â€ <a class="header-anchor" href="#startup-probe-çš„-ç”Ÿäº§çº§æ„ä¹‰" aria-label="Permalink to &quot;startup probe çš„â€œç”Ÿäº§çº§æ„ä¹‰â€&quot;">â€‹</a></h3><blockquote><p>å°±ç»ªæ¢é’ˆç»“åˆå¯åŠ¨æ¢é’ˆä½¿ç”¨ï¼Œé˜²æ­¢éƒ¨åˆ†åº”ç”¨å› ä¸ºå¯åŠ¨æ…¢è¢«è¯¯æ€</p></blockquote><p><strong>è¿™æ˜¯å®˜æ–¹æ¨èæ¨¡å¼</strong>ï¼ˆk8så®˜æ–¹æœ‰yamlæ¡ˆä¾‹ï¼‰ï¼Œä¹Ÿæ˜¯å¤§å‚é€šç”¨åšæ³•ã€‚</p><h4 id="æ­£ç¡®ç»„åˆæ–¹å¼-å‡†ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿" tabindex="-1">æ­£ç¡®ç»„åˆæ–¹å¼ï¼ˆå‡†ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿ï¼‰ <a class="header-anchor" href="#æ­£ç¡®ç»„åˆæ–¹å¼-å‡†ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿" aria-label="Permalink to &quot;æ­£ç¡®ç»„åˆæ–¹å¼ï¼ˆå‡†ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿ï¼‰&quot;">â€‹</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">startupProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/healthz</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  failureThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # æœ€å¤šå…è®¸ 5 åˆ†é’Ÿå¯åŠ¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">livenessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/healthz</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  failureThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/ready</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span></code></pre></div><p>è¿è¡Œæœºåˆ¶ï¼š</p><ul><li><p><strong>å¯åŠ¨é˜¶æ®µ</strong>ï¼šåªçœ‹ startup</p></li><li><p><strong>å¯åŠ¨å®Œæˆå‰</strong>ï¼š</p><ul><li>liveness / readiness å…¨éƒ¨ä¸ç”Ÿæ•ˆ</li></ul></li><li><p><strong>å¯åŠ¨æˆåŠŸå</strong>ï¼š</p><ul><li>liveness è´Ÿè´£â€œæ˜¯å¦è¯¥é‡å¯â€</li><li>readiness è´Ÿè´£â€œæ˜¯å¦æ¥æµé‡â€</li></ul></li></ul><hr><h3 id="ç”Ÿäº§ç¯å¢ƒçš„æ¢é’ˆè®¾è®¡åŸåˆ™-è®°ä½è¿™-4-æ¡" tabindex="-1">ç”Ÿäº§ç¯å¢ƒçš„æ¢é’ˆè®¾è®¡åŸåˆ™ï¼ˆè®°ä½è¿™ 4 æ¡ï¼‰ <a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒçš„æ¢é’ˆè®¾è®¡åŸåˆ™-è®°ä½è¿™-4-æ¡" aria-label="Permalink to &quot;ç”Ÿäº§ç¯å¢ƒçš„æ¢é’ˆè®¾è®¡åŸåˆ™ï¼ˆè®°ä½è¿™ 4 æ¡ï¼‰&quot;">â€‹</a></h3><h4 id="âœ…-åŸåˆ™-1-å…ˆ-readiness-å-liveness" tabindex="-1">âœ… åŸåˆ™ 1ï¼šå…ˆ readinessï¼Œå liveness <a class="header-anchor" href="#âœ…-åŸåˆ™-1-å…ˆ-readiness-å-liveness" aria-label="Permalink to &quot;âœ… åŸåˆ™ 1ï¼šå…ˆ readinessï¼Œå liveness&quot;">â€‹</a></h4><blockquote><p><strong>80% çš„æœåŠ¡ï¼Œåªé… readiness å°±å¤Ÿäº†</strong></p></blockquote><hr><h4 id="âœ…-åŸåˆ™-2-liveness-readiness" tabindex="-1">âœ… åŸåˆ™ 2ï¼šliveness â‰  readiness <a class="header-anchor" href="#âœ…-åŸåˆ™-2-liveness-readiness" aria-label="Permalink to &quot;âœ… åŸåˆ™ 2ï¼šliveness â‰  readiness&quot;">â€‹</a></h4><ul><li>readinessï¼š ğŸ‘‰ <em>â€œæˆ‘ç°åœ¨èƒ½ä¸èƒ½æ¥æµé‡ï¼Ÿâ€</em></li><li>livenessï¼š ğŸ‘‰ <em>â€œæˆ‘æ˜¯ä¸æ˜¯å·²ç»å½»åº•æ²¡æ•‘äº†ï¼Ÿâ€</em></li></ul><hr><h4 id="âœ…-åŸåˆ™-3-æœ‰å¯åŠ¨æ…¢é£é™©-ä¸€å®šåŠ -startup-probe" tabindex="-1">âœ… åŸåˆ™ 3ï¼šæœ‰å¯åŠ¨æ…¢é£é™©ï¼Œä¸€å®šåŠ  startup probe <a class="header-anchor" href="#âœ…-åŸåˆ™-3-æœ‰å¯åŠ¨æ…¢é£é™©-ä¸€å®šåŠ -startup-probe" aria-label="Permalink to &quot;âœ… åŸåˆ™ 3ï¼šæœ‰å¯åŠ¨æ…¢é£é™©ï¼Œä¸€å®šåŠ  startup probe&quot;">â€‹</a></h4><p><strong>è¿™æ˜¯ç”Ÿäº§ä¸å®éªŒç¯å¢ƒçš„åˆ†æ°´å²­</strong></p><hr><h3 id="âœ…-åŸåˆ™-4-æ¢é’ˆæœ¬èº«è¦-ç®€å•ã€ç¨³å®šã€æ— å‰¯ä½œç”¨" tabindex="-1">âœ… åŸåˆ™ 4ï¼šæ¢é’ˆæœ¬èº«è¦â€œç®€å•ã€ç¨³å®šã€æ— å‰¯ä½œç”¨â€ <a class="header-anchor" href="#âœ…-åŸåˆ™-4-æ¢é’ˆæœ¬èº«è¦-ç®€å•ã€ç¨³å®šã€æ— å‰¯ä½œç”¨" aria-label="Permalink to &quot;âœ… åŸåˆ™ 4ï¼šæ¢é’ˆæœ¬èº«è¦â€œç®€å•ã€ç¨³å®šã€æ— å‰¯ä½œç”¨â€&quot;">â€‹</a></h3><p>ä¸åº”è¯¥ï¼š</p><ul><li>è¿æ•°æ®åº“</li><li>æŸ¥å¤–éƒ¨ API</li><li>åšå¤æ‚é€»è¾‘</li></ul><hr><h3 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h3><p>ç”Ÿäº§ç¯å¢ƒéšæ„é…ç½®liveness probeå¯¼è‡´åœ¨podå¯åŠ¨æ…¢æ—¶åå¤é‡å¯ï¼Œå½¢æˆCrashLoopBackOffï¼Œä½¿ç”¨æ—¶åº”è¯¥ç»“åˆå¯åŠ¨æ¢é’ˆï¼Œé˜²æ­¢éƒ¨åˆ†åº”ç”¨å› ä¸ºå¯åŠ¨æ…¢è¢«è¯¯æ€ã€‚</p><p>è¡¥ä¸€å¥ï¼š</p><blockquote><p><em>liveness probe é€‚ç”¨äºè¿›ç¨‹å·²è¿›å…¥ç¨³å®šè¿è¡ŒæœŸåçš„â€œä¸å¯æ¢å¤æ•…éšœâ€æ£€æµ‹</em></p></blockquote>`,102)])])}const g=a(n,[["render",t]]);export{u as __pageData,g as default};
