<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于nerdctl+BuildKit+containerd构建容器镜像 | Kevin Crimson</title>
    <meta name="description" content="Navigating the digital era while rediscovering the balance between ancient Chinese wisdom and modern life.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.Cd2xXf54.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DUVg2eNu.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CSx4Rv_w.js">
    <link rel="modulepreload" href="/assets/chunks/framework.z0p7P-Mv.js">
    <link rel="modulepreload" href="/assets/zh_k8s_BuildContainerImageWithNerdctlAndBuildKit.md.BF0Ax9eS.lean.js">
    <link rel="icon" href="/img/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/img/crimson.png" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Kevin Crimson</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/k8s/index.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Kubernetes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/Prometheus/index.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Prometheus</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-cf11d7a2><span class="text" data-v-cf11d7a2><!----><span data-v-cf11d7a2>Banlance</span><span class="vpi-chevron-down text-icon" data-v-cf11d7a2></span></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/zh/balance/MartialArts/index.html" data-v-35975db6><!--[--><span data-v-35975db6>MartialArts</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/zh/balance/Musings/index.html" data-v-35975db6><!--[--><span data-v-35975db6>Musings</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-cf11d7a2><span class="text" data-v-cf11d7a2><!----><span data-v-cf11d7a2>Other</span><span class="vpi-chevron-down text-icon" data-v-cf11d7a2></span></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/zh/AboutMe.html" data-v-35975db6><!--[--><span data-v-35975db6>About Me</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-6aa21345 data-v-88af2de4 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-cf11d7a2><span class="text" data-v-cf11d7a2><span class="vpi-languages option-icon" data-v-cf11d7a2></span><!----><span class="vpi-chevron-down text-icon" data-v-cf11d7a2></span></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>简体中文</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-35975db6><a class="VPLink link" href="/en/" data-v-35975db6><!--[--><span data-v-35975db6>English</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><div class="group translations" data-v-bb2aa2f0><p class="trans-title" data-v-bb2aa2f0>简体中文</p><!--[--><div class="VPMenuLink" data-v-bb2aa2f0 data-v-35975db6><a class="VPLink link" href="/en/" data-v-35975db6><!--[--><span data-v-35975db6>English</span><!--]--></a></div><!--]--></div><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>返回顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>目录</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _zh_k8s_BuildContainerImageWithNerdctlAndBuildKit" data-v-39a288b8><div><h1 id="基于nerdctl-buildkit-containerd构建容器镜像" tabindex="-1">基于nerdctl+BuildKit+containerd构建容器镜像 <a class="header-anchor" href="#基于nerdctl-buildkit-containerd构建容器镜像" aria-label="Permalink to &quot;基于nerdctl+BuildKit+containerd构建容器镜像&quot;">​</a></h1><h2 id="_0-容器基础知识" tabindex="-1">0 容器基础知识 <a class="header-anchor" href="#_0-容器基础知识" aria-label="Permalink to &quot;0 容器基础知识&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">容器技术除docker之外，还有coreOS的rkt、google的gvisor、以及docker开源的containerd、redhat的podman、阿里的pouch等，为了保证容器生态的标准性和健康可持续发展，包括Docker、华为、微软、红帽、谷歌、AWS、IBM等公司在2015年6月共同成立了一个叫open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container（OCI，https://opencontainers.org/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ）的组织，其目的就是制定开放的标准的容器规范，目前OCI一共发布了三个规范，分别是运行时规范（runtime-spec）、镜像规范（image-spec）和分发规范（distribution-spec），有了以上的规范，就可以保证不同容器的可移植性和相互兼容性。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://containerd.io/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://gvisor.dev/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://podman.io/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://github.com/rkt/rkt</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #已停止维护</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://github.com/alibaba/pouch</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #阿里开源</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#安装文档，目前版本不支持Ubuntu 2204</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://github.com/AliyunContainerService/pouch/blob/master/INSTALLATION.md</span></span></code></pre></div><h3 id="_0-1-镜像构建方式" tabindex="-1">0.1 镜像构建方式 <a class="header-anchor" href="#_0-1-镜像构建方式" aria-label="Permalink to &quot;0.1 镜像构建方式&quot;">​</a></h3><h4 id="_0-1-1-使用主机构建" tabindex="-1">0.1.1 使用主机构建 <a class="header-anchor" href="#_0-1-1-使用主机构建" aria-label="Permalink to &quot;0.1.1 使用主机构建&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Docker</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #通用的容器镜像构建工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nerdctl+BuildKit+containerd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #https://github.com/moby/buildkit ,下一代镜像构建工具</span></span></code></pre></div><p>图一：业务流程</p><p><img src="/img/k8s/buildProcedure.png" alt="业务流程"></p><p>图二：构建环境区别</p><p><img src="/img/k8s/imgBuildDiffrents.png" alt="构建环境区别"></p><h4 id="_0-1-2-kubernetes环境使用kaniko动态pod构建" tabindex="-1">0.1.2.kubernetes环境使用Kaniko动态Pod构建： <a class="header-anchor" href="#_0-1-2-kubernetes环境使用kaniko动态pod构建" aria-label="Permalink to &quot;0.1.2.kubernetes环境使用Kaniko动态Pod构建：&quot;">​</a></h4><p>参考： <a href="https://github.com/GoogleContainerTools/kaniko" target="_blank" rel="noreferrer">https://github.com/GoogleContainerTools/kaniko</a> #官方git仓库, 已不再更新 <a href="https://github.com/kaniko-build/builder" target="_blank" rel="noreferrer">https://github.com/kaniko-build/builder</a> #三方Git维护 <a href="https://gallery.ecr.aws/pergola/kaniko-project/executor" target="_blank" rel="noreferrer">https://gallery.ecr.aws/pergola/kaniko-project/executor</a> #AWS镜像仓库</p><h2 id="_1-部署buildkit" tabindex="-1">1 部署BuildKit <a class="header-anchor" href="#_1-部署buildkit" aria-label="Permalink to &quot;1 部署BuildKit&quot;">​</a></h2><ul><li>2017年由 docker 的创始人 ( tonistiigi 托尼斯蒂吉) 提议，将docker build 的能力独立成一个项目，针对构建的底层技术进行协作，更好复用和定制构建技术，该将项目即buildkit。</li><li>BuildKit是 Docker 官方社区推出的下一代镜像构建工具，官方宣称通过 BuildKit 可以更加快速、有效、安全地构建容器镜像。</li></ul><h3 id="_1-1-buildkit组成部分" tabindex="-1">1.1 BuildKit组成部分 <a class="header-anchor" href="#_1-1-buildkit组成部分" aria-label="Permalink to &quot;1.1 BuildKit组成部分&quot;">​</a></h3><p><a href="https://github.com/moby/buildkit" target="_blank" rel="noreferrer">https://github.com/moby/buildkit</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>buildkitd(服务端)，目前支持runc和containerd作为镜像构建环境，默认是runc，可以更换为containerd。</span></span>
<span class="line"><span>buildctl(客户端)，负责解析Dockerfile文件，并向服务端buildkitd发出构建请求。</span></span></code></pre></div><h3 id="_1-2-安装buildkitd" tabindex="-1">1.2 安装buildkitd <a class="header-anchor" href="#_1-2-安装buildkitd" aria-label="Permalink to &quot;1.2 安装buildkitd&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@k8s-master1:/usr/local/src#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/local/src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@k8s-master1:/usr/local/src#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https://github.com/moby/buildkit/releases/download/v0.26.3/buildkit-v0.26.3.linux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">amd64.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@k8s-master1:/usr/local/src#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  buildkit-v0.26.3.linux-amd64.tar.gz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@k8s-master1:/usr/local/src#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@k8s-master1:/usr/local/src#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> buildctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --help</span></span></code></pre></div><h3 id="_1-3-使用systemd-service运行" tabindex="-1">1.3 使用systemd service运行 <a class="header-anchor" href="#_1-3-使用systemd-service运行" aria-label="Permalink to &quot;1.3 使用systemd service运行&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#buildkit.socket</span></span>
<span class="line"><span>root@k8s-master1:/usr/local/src# vim /lib/systemd/system/buildkit.socket</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=BuildKit</span></span>
<span class="line"><span>Documentation=https://github.com/moby/buildkit</span></span>
<span class="line"><span>[Socket]</span></span>
<span class="line"><span>ListenStream=%t/buildkit/buildkitd.sock</span></span>
<span class="line"><span>SocketMode=0660</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=sockets.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#buildkitd.service </span></span>
<span class="line"><span>root@k8s-master1:/usr/local/src# vim  /lib/systemd/system/buildkit.service </span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=BuildKit</span></span>
<span class="line"><span>Requires=buildkit.socket</span></span>
<span class="line"><span>After=buildkit.socketDocumentation=https://github.com/moby/buildkit</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>ExecStart=/usr/local/bin/buildkitd --oci-worker=false --containerd-worker=true</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>root@k8s-master1:/usr/local/src# systemctl daemon-reload &amp;&amp; systemctl enable buildkit &amp;&amp; </span></span>
<span class="line"><span>systemctl restart  buildkit &amp;&amp; systemctl status  buildkit</span></span></code></pre></div><h2 id="_2测试镜像构建" tabindex="-1">2测试镜像构建 <a class="header-anchor" href="#_2测试镜像构建" aria-label="Permalink to &quot;2测试镜像构建&quot;">​</a></h2><h2 id="_2-1-nerdctl常用命令" tabindex="-1">2.1 nerdctl常用命令 <a class="header-anchor" href="#_2-1-nerdctl常用命令" aria-label="Permalink to &quot;2.1 nerdctl常用命令&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># nerdctl  login harbor.yourdomainname</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># nerdctl pull</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># nerdctl tag </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># nerdctl  push</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#信任自签发的证书</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># nerdctl --insecure-registry  push</span></span></code></pre></div><h2 id="_2-2-镜像构建" tabindex="-1">2.2 镜像构建 <a class="header-anchor" href="#_2-2-镜像构建" aria-label="Permalink to &quot;2.2 镜像构建&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cat Dockerfile </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-hangzhou.aliyuncs.com/myhubregistry/ubuntu:24.04.3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-certificates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gnupg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cat build-command.sh </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nerdctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> harbor.yourdomainname/baseimages/ubuntu:24.04.3-base</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nerdctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> harbor.yourdomainname/baseimages/ubuntu:24.04.3-base</span></span></code></pre></div><p>执行构建脚本后可以使用浏览器访问harbor进行验证</p><h2 id="_3-基于自定义镜像创建容器" tabindex="-1">3 基于自定义镜像创建容器 <a class="header-anchor" href="#_3-基于自定义镜像创建容器" aria-label="Permalink to &quot;3 基于自定义镜像创建容器&quot;">​</a></h2><h3 id="_3-1-nerdctl命令创建测试容器" tabindex="-1">3.1 nerdctl命令创建测试容器 <a class="header-anchor" href="#_3-1-nerdctl命令创建测试容器" aria-label="Permalink to &quot;3.1 nerdctl命令创建测试容器&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#nerdctl run --rm -it -p 80:80 harbor.yourdomianname/myserver/nginx-base:ubuntu2204-nginx-1.28.1</span></span></code></pre></div><h3 id="_3-2-docker命令创建测试容器" tabindex="-1">3.2 docker命令创建测试容器 <a class="header-anchor" href="#_3-2-docker命令创建测试容器" aria-label="Permalink to &quot;3.2 docker命令创建测试容器&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#docker run --rm -it -p 80:80 harbor.yourdomianname/myserver/nginx-base:ubuntu2204-nginx-1.28.1</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><!----></footer><!--[--><!--[--><!--[--><div class="comment" data-v-97a23b9e><script src="https://giscus.app/client.js" data-repo="Kshaoye/kshaoye.github.io" data-repo-id="R_kgDOK9I0lg" data-category="Announcements" data-category-id="DIC_kwDOK9I0ls4Cefc1" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="zh-CN" crossorigin="anonymous" data-loading="eager" async data-v-97a23b9e></script></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"en_aboutme.md\":\"DAKsaFN4\",\"en_balance_martialarts_index.md\":\"i91WJyGQ\",\"en_balance_martialarts_taijiswordsizechart.md\":\"CySToHzF\",\"en_balance_musings_index.md\":\"BVKgwA_P\",\"en_index.md\":\"DHWNlBlb\",\"index.md\":\"DYl6wwZc\",\"private_studio.md\":\"Df-bXqfZ\",\"private_中国剑.md\":\"ndYIZhwv\",\"private_公有云集群规划.md\":\"BrKOlE2O\",\"private_实验记录.md\":\"Wy-buO8w\",\"zh_aboutme.md\":\"DlSjsID3\",\"zh_balance_index.md\":\"DEu014k_\",\"zh_balance_martialarts_index.md\":\"B5qu9RfN\",\"zh_balance_martialarts_taijiswordsizechart.md\":\"Da-Sge1R\",\"zh_balance_martialarts_wuxiansword.md\":\"DAanHnl2\",\"zh_balance_musings_index.md\":\"C3w6AMB4\",\"zh_k8s_buildcontainerimagewithnerdctlandbuildkit.md\":\"BF0Ax9eS\",\"zh_k8s_deployandmaintainnginxserviceink8scluster.md\":\"Dkj93u6D\",\"zh_k8s_deployk8sclusterwithkubeasz.md\":\"DvPXF1ja\",\"zh_k8s_etcdbackupandrestore.md\":\"Dh_6oOQu\",\"zh_k8s_index.md\":\"qHhniDVA\",\"zh_k8s_interviewquestions_index.md\":\"DWaccHdS\",\"zh_k8s_interviewquestions_procedure_of_accessing_nodeport_pods_from_load_balancer.md\":\"DLX77Qk9\",\"zh_k8s_interviewquestions_procedure_of_creating_pods.md\":\"3oAv_HXP\",\"zh_k8s_interviewquestions_what_happens_when_a_probe_fails_in_kubernetes.md\":\"w09iNlpM\",\"zh_k8s_interviewquestions_why_do_production_environments_use_pod_directly_mount_nfs.md\":\"DBecEeiG\",\"zh_k8s_k8scommandcheatsheet.md\":\"CiOWg6J6\",\"zh_k8s_k8snodescaling.md\":\"DvbfEPGz\",\"zh_k8s_k8srunjavajenkinswithpersistence.md\":\"IRB0hvdm\",\"zh_k8s_k8srunwordpresswithmysql.md\":\"Cj77hlLV\",\"zh_k8s_kubernetescorecomponents.md\":\"COfzkrL9\",\"zh_k8s_layeredbuildsystemimageandwebserviceimage.md\":\"BOwpiT42\",\"zh_k8s_nginxjavanfsseparatedarchitecture.md\":\"CzQMfO7s\",\"zh_k8s_podmountvolumes.md\":\"DnI9HBTN\",\"zh_k8s_probe.md\":\"RuFfSDed\",\"zh_k8s_statefulsetmysql.md\":\"rR8YT7n3\",\"zh_k8s_statefulsetrediscluster.md\":\"DSWEdzH1\",\"zh_k8s_statefulsetzookeeper.md\":\"492UwgYf\",\"zh_prometheus_index.md\":\"CcQWDNgm\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en\",\"dir\":\"ltr\",\"title\":\"Kevin Crimson\",\"description\":\"Navigating the digital era while rediscovering the balance between ancient Chinese wisdom and modern life.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/img/alemon.jpg\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Kubernetes\",\"link\":\"/zh/k8s/index\"},{\"text\":\"Prometheus\",\"link\":\"/zh/Prometheus/index\"},{\"text\":\"Banlance\",\"items\":[{\"text\":\"MartialArts\",\"link\":\"/zh/balance/MartialArts/index\"},{\"text\":\"Musings\",\"link\":\"/zh/balance/Musings/index\"}]},{\"text\":\"Other\",\"items\":[{\"text\":\"About Me\",\"link\":\"/zh/AboutMe\"}]}],\"localeLinks\":{\"text\":\"Languages\",\"items\":[{\"text\":\"简体中文\",\"link\":\"/\"},{\"text\":\"English\",\"link\":\"/en/\"}]},\"i18nRouting\":false,\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"zh\":{\"translations\":{\"button\":{\"buttonText\":\"搜索\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询结果\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}},\"en\":{\"translations\":{\"button\":{\"buttonText\":\"Search\",\"buttonAriaLabel\":\"Search for Documents\"},\"modal\":{\"noResultsText\":\"Unable to find relevant results\",\"resetButtonTitle\":\"Clear Query Results\",\"footer\":{\"selectText\":\"select\",\"navigateText\":\"switch\"}}}}}}}},\"locales\":{\"zh\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"link\":\"/\",\"themeConfig\":{\"lastUpdatedText\":\"上次更新\",\"returnToTopLabel\":\"返回顶部\",\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"logo\":\"/img/crimson.png\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Kubernetes\",\"link\":\"/zh/k8s/index\"},{\"text\":\"Prometheus\",\"link\":\"/zh/Prometheus/index\"},{\"text\":\"Banlance\",\"items\":[{\"text\":\"MartialArts\",\"link\":\"/zh/balance/MartialArts/index\"},{\"text\":\"Musings\",\"link\":\"/zh/balance/Musings/index\"}]},{\"text\":\"Other\",\"items\":[{\"text\":\"About Me\",\"link\":\"/zh/AboutMe\"}]}],\"localeLinks\":{\"text\":\"语言/Language\",\"items\":[{\"text\":\"简体中文\",\"link\":\"/\"},{\"text\":\"English\",\"link\":\"/en/\"}]},\"outline\":{\"level\":\"deep\",\"label\":\"目录\"}}},\"en\":{\"label\":\"English\",\"lang\":\"en-US\",\"link\":\"/en/\",\"themeConfig\":{\"lastUpdatedText\":\"Last Updated\",\"returnToTopLabel\":\"Return to Top\",\"docFooter\":{\"prev\":\"Previous Page\",\"next\":\"Next Page\"},\"logo\":\"/img/crimson.png\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"MartialArts\",\"link\":\"/en/balance/MartialArts/index\"},{\"text\":\"Musings\",\"link\":\"/en/balance/Musings/index\"},{\"text\":\"Other\",\"items\":[{\"text\":\"About Me\",\"link\":\"/AboutMe\"}]}],\"localeLinks\":{\"text\":\"语言/Language\",\"items\":[{\"text\":\"简体中文\",\"link\":\"/\"},{\"text\":\"English\",\"link\":\"/en/\"}]},\"outline\":{\"level\":\"deep\",\"label\":\"Contents\"}}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>